<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Birthdays</title>
    <link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/reset.css">
	<script type="text/javascript">		
		// TO-DO
		// - Incorporate time zones
		// - Collect user input and calculate based on that (instead of fixed value)
		// - Insert/Modify/Update multiple birthdays and display them in a table
		
		//Globals
		var YEAR_IN_MILLISECONDS = 31557600000;
		
		//birthdate in year-month-day format - Example: 2013-04-13 is saturday april 13
		var dateString = "1987-12-03";
		var age = calcAge(dateString);
		var futureBday = nextBday(dateString, age);
		var birthday = curBday(dateString);
		
		function calcBday (form) {

			//assigns user input to variable
			dateString = form.userBday.value;
			//get the input
			var tbox = document.getElementsByName('displayBday')[0];
			//change value of textbox to user input
			tbox.value = bday;

			
			
			birthdate = 0;
			nextBirthdate = futureDayToString(futureBday);
			age.value = age;
			daysLeft = 0;
			
			/*
			//Displays the age
			document.write("<div id='old'>");
			document.write("<h2>Age: </h2>");
			document.write("<h3>" + age + "</h3>");
			//Displays the next birthdate
			document.write("<h2>Next Birthday: </h2>");
			document.write("<h3>" + findDay(futureBday) + ", " + (futureBday.getDate()+1) + " " + findMonth(futureBday) + " " + futureBday.getFullYear() + "</h3>");
			//Displays the days left until next birthdate
			document.write("<h2> Days left: </h2>");
			document.write("<h3>" + daysLeft(futureBday) + "</h3>");
			//Displays the Birthday
			document.write("<h2>Birthday: </h2>");
			document.write("<h3>" + findDay(birthday) + ", " + (birthday.getDate()) + " " + findMonth(birthday) + " " + birthday.getFullYear() + "</h3>");
			document.write("<h1>" + dateString + "</h1>");
			document.write("</div>");
			*/
			
			/* HELPFUL DEBUGGING CODE
				document.write("futureBday: " + futureBday.getDay() + "  - birthday: " + birthday.getDay());
				document.write("<br />");
				document.write("futureBday: " + nextBday(dateString, age));
				document.write("<br />");
				document.write("curBday: " + curBday(dateString));
			*/

			//convert epoch to readable
			//var myDate = new Date(565506000*1000);
			//document.write(myDate);
			
			//convert readable to epoch
			//var meDate = new Date("December 3, 1987 00:00:00");
			//var meData = meDate.getTime()/1000.0;
			//document.write("<br /> " + meData);
		}
		
		//calculate birthday
		function calcAge(dateString) {
			var birthday = +new Date(dateString);
			return~~ ((Date.now() - birthday) / (YEAR_IN_MILLISECONDS));
		}
		function curBday(dateString){
			var ubday = new Date(dateString);
			//add 5 hours to time to makeup for GMT - Time zones on to-do list
			ubday.setHours(ubday.getHours() + 5)
			return ubday;
		}
		function nextBday(dateString, age){
			var age = age + 1;
			//it has to be 365.27 because a year is actually something like 365.27 days
				//var yearDate = age * 365.27;
				//var birthday = new Date(dateString);
				//birthday.setDate(birthday.getDate() + yearDate);
				//1 year in milliseconds = 31556900000
			var yearDate = age * 365.27;
			var birthday = new Date(dateString);
			//console.log(birthday); debugging line
			birthday.setDate(birthday.getDate() + yearDate);
			return birthday;
		}
		function daysLeft(futureBday){
			//this is your birthday in epoch time
			var bDay = new Date(futureBday);
			var today = new Date();
			var msPerDay = 24*60*60*1000;
			//figure out the date of your next birthday
			//NOTE: this is rounded up (Math.round) no matter what so that the day before it won't say '0 days' or '.23' days remaining
			var x = Math.round(((bDay.getTime() - today.getTime())/ msPerDay));
			return x;
		}
		function futureDayToString (futureBday){
			var futureBday = this.futureBday;
			var day = findDay(futureBday) + ", " + (futureBday.getDate()+1) + " " + findMonth(futureBday) + " " + futureBday.getFullYear();
		}
		
		function findDay(nextBday){
			var day = nextBday.getDay();
			var x;
			switch(day){
			case 0:
			  x="Sunday";
			  break;
			case 1:
			  x="Monday";
			  break;
			case 2:
			  x="Tuesday";
			  break;
			case 3:
			  x="Wednesday";
			  break;
			case 4:
			  x="Thursday";
			  break;
			case 5:
			  x="Friday";
			  break;
			case 6:
			  x="Saturday";
			  break;
			default:
			  document.write("Invalid weekday");
			  x = -1;
			}
			return x;
		}
		function findMonth(nextBday){
			var month =  nextBday.getMonth();
			var x;
			switch(month){
				case 0:
			  x="January";
			  break;
			case 1:
			  x="February";
			  break;
			case 2:
			  x="March";
			  break;
			case 3:
			  x="April";
			  break;
			case 4:
			  x="May";
			  break;
			case 5:
			  x="June";
			  break;
			case 6:
			  x="July";
			  break;
			case 7:
			  x="August";
			  break;
			case 8:
			  x="September";
			  break;
			case 9:
			  x="October";
			  break;
			case 10:
			  x="November";
			  break;
			case 11:
			  x="December";
			}
			return x;
		}
	</script>
</head>
<body>
<div id="container">
<h1>Birthday Calculator</h1>
<h4>Beta</h4>
<form name="bdayForm" action="" method="get">
	<h2>Enter your birthday</h2><input type="text" name="userBday" value="" />
	<h2>Birthdate</h2><input type="text" name="birthdate" value="" />
	<h2>Next birthdate</h2><input type="text" name="nextBirthdate" value="" />
	<h2>Age</h2><input type="text" name="age" value="" />
	<h2>Days left</h2><input type="text" name="daysLeft" value="" />
	
	<input type="button" value="Calc" onClick="calcBday(this.form)" />
</form>
<input type="text" name="displayBday" />
<script>

</script>

</div><!--end container-->
</body>
</html>