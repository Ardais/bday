<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Birthdays</title>
	<link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
	<script type="text/javascript">		
		// TO-DO
		// - Incorporate time zones
		// - Format user input no matter what they type or use datepicker
		// - Insert/Modify/Update multiple birthdays and display them in a table
		
		//Globals
		var YEAR_IN_MILLISECONDS = 31557600000;
		var dateString; //birthdate in year-month-day format - Example: 2013-04-13 is saturday april 13
		var age;
		var futureBday;
		var birthday;
		
		function calcBday (form) {
			//assigns user input to variable
			dateString = form.userBday.value;
			//calculation of user input
			birthday = curBday(dateString);
				//console.log("| " + birthday + " | - this the original birthdate"); 
			age = calcAge(dateString);
			futureBday = nextBday(dateString, age);
				//console.log("|| " + futureBday + " || - this is the future birthdates original calculation");
			futureBday = curBday(futureBday);
				//console.log("||| " + futureBday + " ||| - this is the adjusted birthdate");
			//console.log(futureBday + " - calculations");
			
			
			//test logs
			var d = new Date(dateString);
			//console.log(d);
			
			//Get input boxes by name
			var birthdateBox = document.getElementsByName('birthdate')[0];
			var nextBirthdateBox = document.getElementsByName('nextBirthdate')[0];
			var ageBox = document.getElementsByName('age')[0];
			var daysLeftBox = document.getElementsByName('daysLeft')[0];
			//Assign the calculated values to the input boxes
			birthdateBox.value = birthdateToString(birthday);
			nextBirthdateBox.value = futureDayToString(futureBday);
			ageBox.value = age;
			daysLeftBox.value = daysLeft(futureBday);
			
			/* HELPFUL DEBUGGING CODE
				document.write("futureBday: " + futureBday.getDay() + "  - birthday: " + birthday.getDay());
				document.write("<br />");
				document.write("futureBday: " + nextBday(dateString, age));
				document.write("<br />");
				document.write("curBday: " + curBday(dateString));
			*/

			//convert epoch to readable
			//var myDate = new Date(565506000*1000);
			//document.write(myDate);
			
			//convert readable to epoch
			//var meDate = new Date("December 3, 1987 00:00:00");
			//var meData = meDate.getTime()/1000.0;
			//document.write("<br /> " + meData);
		}
		
		//calculate birthday
		function calcAge(dateString) {
			var birthday = +new Date(dateString);
			return~~ ((Date.now() - birthday) / (YEAR_IN_MILLISECONDS));
		}
		function curBday(dateString){
			var ubday = new Date(dateString);
			//add 5 hours to time to makeup for GMT - Time zones on to-do list
			ubday.setHours(ubday.getHours() + 5);
			return ubday;
		}
		function nextBday(dateString, age){
			var age = age + 1;
			//it has to be 365.27 because a year is actually something like 365.27 days
				//var yearDate = age * 365.27;
				//var birthday = new Date(dateString);
				//birthday.setDate(birthday.getDate() + yearDate);
				//1 year in milliseconds = 31556900000
			var yearDate = age * 365.25;
			var birthday = new Date(dateString);
			birthday.setDate(birthday.getDate() + yearDate);
			//console.log(birthday);
			return birthday;
		}
		function daysLeft(futureBday){
			//this is your birthday in epoch time
			var bDay = new Date(futureBday);
			var today = new Date();
			var msPerDay = 24*60*60*1000;
			//figure out the date of your next birthday
			//NOTE: this is rounded up (Math.round) no matter what so that the day before it won't say '0 days' or '.23' days remaining
			var x = Math.round(((bDay.getTime() - today.getTime())/ msPerDay));
			return x;
		}
		function futureDayToString (futureBday){
			var futureBday = this.futureBday;
			//console.log(futureBday + " - futureDayToString()");
			var day = findDay(futureBday) + ", " + (futureBday.getDate()/*+1*/) + " " + findMonth(futureBday) + " " + futureBday.getFullYear();
			return day;
		}
		function birthdateToString (Bday){
			var birthday = Bday;
			var day = findDay(birthday) + ", " + (birthday.getDate()) + " " + findMonth(birthday) + " " + birthday.getFullYear();
			return day;
		}
		
		function findDay(nextBday){
			var day = nextBday.getDay();
			var x;
			switch(day){
			case 0:
			  x="Sunday";
			  break;
			case 1:
			  x="Monday";
			  break;
			case 2:
			  x="Tuesday";
			  break;
			case 3:
			  x="Wednesday";
			  break;
			case 4:
			  x="Thursday";
			  break;
			case 5:
			  x="Friday";
			  break;
			case 6:
			  x="Saturday";
			  break;
			default:
			  console.log("Invalid weekday");
			  x = -1;
			}
			return x;
		}
		function findMonth(nextBday){
			var month =  nextBday.getMonth();
			var x;
			switch(month){
			case 0:
			  x="January";
			  break;
			case 1:
			  x="February";
			  break;
			case 2:
			  x="March";
			  break;
			case 3:
			  x="April";
			  break;
			case 4:
			  x="May";
			  break;
			case 5:
			  x="June";
			  break;
			case 6:
			  x="July";
			  break;
			case 7:
			  x="August";
			  break;
			case 8:
			  x="September";
			  break;
			case 9:
			  x="October";
			  break;
			case 10:
			  x="November";
			  break;
			case 11:
			  x="December";
			}
			return x;
		}
	</script>
</head>
<body>
<div id="container">
<nav>
<h1>Birthday Calculator</h1>
<h4>Alpha</h4>
</nav>
<form name="bdayForm" action="" method="get">
	<!--
	<h2>Enter your birthday</h2>
	
	<input type="text" name="userBday" value="1988-12-29" />
	
	
	<h2>Birthdate</h2>
	
	<input type="text" name="birthdate" value="" />
	
	
	<h2>Next birthdate</h2>
	
	<input type="text" name="nextBirthdate" value="" />
	
	
	<h2>Age</h2>
	
	<input type="text" name="age" value="" />
	
	
	<h2>Days left</h2>
	
	<input type="text" name="daysLeft" value="" />
	
	
	<br /><br />
	
	
	<input type="button" value="Calc" onClick="calcBday(this.form)" />
	-->
	<table border="1">
		<tr><td><h2 id="firstRow">Enter your birthday</h2></td><td class="middle"></td><td><input type="text" name="userBday" class="userInput" maxlength="10" value="1988-12-29" /></td></tr>
		<tr><td></td><td class="middle"></td><td><h5>yyyy-mm-dd</h5></td></tr>
		<tr><td><h2>Age</h2></td><td class="middle"></td><td><input type="text" class="output" name="age" value="" readonly /></td></tr>
		<tr><td><h2>Birthdate</h2></td><td class="middle"></td><td><input type="text" class="output" name="birthdate" value="" readonly /></td></tr>
		<tr><td><h2>Next birthdate</h2></td><td class="middle"></td><td><input type="text" class="output" name="nextBirthdate" value="" readonly /></td></tr>
		<tr><td><h2>Days left</h2></td><td class="middle"></td><td><input type="text" class="output" name="daysLeft" value="" readonly /></td></tr>
		<tr><td><h2><input type="button" value="Calculate" onClick="calcBday(this.form)" /></h2></td><td class="middle"></td><td></td></tr>
	</table>
	
	
</form>
</div><!--end container-->
</body>
</html>